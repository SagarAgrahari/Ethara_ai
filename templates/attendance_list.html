{% extends 'base.html' %}

{% block content %}
  <div class="section-header">
    <div>
      <h3><i class="fas fa-calendar-check"></i> Attendance Records</h3>
      <p class="text-muted">View and manage daily attendance</p>
    </div>
    <a class="btn btn-primary" href="/attendance/mark/"><i class="fas fa-pen-fancy"></i> Mark Attendance</a>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3"><i class="fas fa-filter"></i> Filter Records</h5>
      <form method="get" id="filterForm" class="row g-3">
        <div class="col-md-4">
          <label for="filterEmployee" class="form-label"><i class="fas fa-user"></i> Employee</label>
          <select id="filterEmployee" name="employee" class="form-select">
            <option value="">All Employees</option>
            {% for emp in employees %}
              <option value="{{ emp.id }}" {% if selected_employee == emp.id %}selected{% endif %}>
                {{ emp.emp_id }} - {{ emp.full_name }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <label for="filterDate" class="form-label"><i class="fas fa-calendar-alt"></i> Date</label>
          <input type="text" id="filterDate" name="date" class="form-control flatpickr-date" placeholder="Select date (YYYY-MM-DD)" value="{{ selected_date|default:'' }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">&nbsp;</label>
          <div class="d-grid gap-2 d-md-flex">
            <button type="submit" class="btn btn-primary flex-grow-1"><i class="fas fa-search"></i> Filter</button>
            <button type="button" id="resetBtn" class="btn btn-secondary"><i class="fas fa-redo"></i> Reset</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  {% if attendance_stats %}
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card text-center border-primary">
          <div class="card-body">
            <i class="fas fa-calendar-days" style="font-size: 2rem; color: #0d6efd; margin-bottom: 0.5rem;"></i>
            <h6 class="card-title text-muted mb-2">Total Working Days</h6>
            <h3 class="card-text text-primary">{{ attendance_stats.working_days }}</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center border-success">
          <div class="card-body">
            <i class="fas fa-check-circle" style="font-size: 2rem; color: #198754; margin-bottom: 0.5rem;"></i>
            <h6 class="card-title text-muted mb-2">Present Days</h6>
            <h3 class="card-text text-success">{{ attendance_stats.present_days }}</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center border-danger">
          <div class="card-body">
            <i class="fas fa-times-circle" style="font-size: 2rem; color: #dc3545; margin-bottom: 0.5rem;"></i>
            <h6 class="card-title text-muted mb-2">Absent Days</h6>
            <h3 class="card-text text-danger">{{ attendance_stats.absent_days }}</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center border-warning">
          <div class="card-body">
            <i class="fas fa-clock" style="font-size: 2rem; color: #ffc107; margin-bottom: 0.5rem;"></i>
            <h6 class="card-title text-muted mb-2">Pending Days</h6>
            <h3 class="card-text text-warning">{{ attendance_stats.pending_days }}</h3>
          </div>
        </div>
      </div>
    </div>
    <div class="alert alert-info mb-4">
      <i class="fas fa-info-circle"></i> <strong>{{ attendance_stats.employee_id }} - {{ attendance_stats.employee_name }}</strong> | Current Month Statistics
    </div>
  {% else %}
    <div class="alert alert-secondary mb-4">
      <i class="fas fa-info-circle"></i> <strong>Tip:</strong> Select an employee from the filter to view their monthly attendance statistics (working days, present, absent, and pending days)
    </div>
  {% endif %}

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('resetBtn').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('filterEmployee').value = '';
        document.getElementById('filterDate').value = '';
        const filterDate = document.getElementById('filterDate');
        if (filterDate._flatpickr) {
          filterDate._flatpickr.clear();
        }
        window.location.href = '/attendance/';
      });
    });
  </script>
  {% if attendances %}
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th><i class="fas fa-id-badge"></i> Emp ID</th>
                <th><i class="fas fa-user"></i> Name</th>
                <th><i class="fas fa-calendar"></i> Date</th>
                <th><i class="fas fa-check-circle"></i> Status</th>
              </tr>
            </thead>
            <tbody>
              {% for a in attendances %}
                <tr>
                  <td><strong>{{ a.employee.emp_id }}</strong></td>
                  <td>{{ a.employee.full_name }}</td>
                  <td>{{ a.date|date:"d M, Y" }}</td>
                  <td>
                    {% if a.status == 'Present' %}
                      <span class="badge bg-success"><i class="fas fa-check"></i> Present</span>
                    {% else %}
                      <span class="badge bg-danger"><i class="fas fa-times"></i> Absent</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% else %}
    <div class="empty-state">
      <i class="fas fa-inbox" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
      <p>No attendance records yet</p>
      <a class="btn btn-primary" href="/attendance/mark/"><i class="fas fa-pen-fancy"></i> Mark Attendance</a>
    </div>
  {% endif %}

{% endblock %}

